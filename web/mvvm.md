title: MVVM
date: 2013/5/7

MVVM
===
最近跟风玩mvvm。不过这东西确实神奇，你不需要任何dom操作就能完成复杂的表单。

mvvm的目标就是0dom操作

我最近碰到一个非常奇葩的需求=》修改hosts文件，每项host都要可以改，且提供增删功能。

总之我写了不少繁琐的代码完成了这个需求。不过我自己都觉得丑。

什么是MVVM？
--------
mvvm是mvc的变种。mvc是啥具体我不大知道，大约是为了数据与视图分离。

mvvm同样如此。（m=model，v=view，vm=viewModel）

网页中mvvm具体是什么呢？

那些写mvvm框架的大神貌似根本不屑于提这个。搞的我理解了n久。

我认为网页中的mvvm具体对应的就是：

1. model： 一个hash对象。就是自己的数据模型

2. view：视图，一个container。我在自己写的时候直接把view定义为一个div的id。

3. viewModel：用来生成view的模板。这里显然就是html模板。我自己写的时候直接定义为模板id。

mvvm的种类
-------------

mvvm因为html模板的实现方式有两种。

一种html模板是用innerHTML加进去的。（我自己只会写这种模板）

另一种是解析成dom插入进去的。

第二种非常厉害，由于是dom，他们可以直接给dom加上属性。这样就不会把dom的属性暴露在外面。

第一种就不行了，必须把name，data-bind。这些attribute写在html中。暴露了逻辑，但只有这样才能绑定数据

我个人只会第二种，使用name绑定数据，这样未必不好，因为可以直接写html代码，更容易理解。

开发过程中一些问题
-------
我本来打算对view的数据改动监听分两种的，一种是弱监听，一种是强监听

弱监听: 给所有有value的绑上change事件。只有change才会触发。

强监听： 对所有可能导致数据变化的事件监听，如click，keyup（只能是keyup否则value不变）。通过srcElement或者target来判断是否是需要监听对象

后来发现弱监听挫爆了。每次重新渲染，事件都没了，需要重新绑定一遍。所以直接抛弃了。

不知道别的框架怎么做的。我估计都是我所谓的强监听。（这个也是我自己瞎想的，完全不知道别人怎么实现）

demo
-------
为了演示这个mvvm。我做了4个

###[demo](http://42.121.108.75/mvvm)

1. demo0:

 >hello world，展示基本的动态修改model

2. demo1:

 >展示了嵌套功能，对于复杂逻辑（比如嵌套），form表单显的难以应付，但是我这个mvvm毫无压力

3. demo2：

 >展示了列表逻辑的增删改，比如增加到开头，增加到末尾，我个人认为这个是最常用的

4. demo3：

 >展示多标签支持，有基本的表单标签，如input，radio，checkbox，select，textarea.

 >其中checkbox是个小难点，做了专门的处理

 总结
 -------
 反正我觉得做像啦，因为至少它work了！

 而且使用起来比别的框架简单太多。

 其他功能等碰到具体需求再改进吧


